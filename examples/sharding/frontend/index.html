<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="js/d3.min.js"></script>
    <script type="text/javascript" src="js/lodash.js"></script>
    <script type="module" src="./js/index.js"></script>
  </head>
  <body>
    <!-- <script type="text/javascript">
      const nodes = [
        {"id": "aspyn", "group": 1, "x_axis": 330, "y_axis": 30},
        {"id": "alex", "group": 1, "x_axis": 380, "y_axis": 90},
        {"id": "rob", "group": 1, "x_axis": 320, "y_axis": 80},
        {"id": "zx", "group": 1, "x_axis": 360, "y_axis": 40},
        {"id": "ken", "group": 2, "x_axis": 300, "y_axis": 300},
        {"id": "jake", "group": 2, "x_axis": 350, "y_axis": 280},
        {"id": "yung", "group": 2, "x_axis": 270, "y_axis": 250},
        {"id": "ani", "group": 3, "x_axis": 140, "y_axis": 130},
        {"id": "boon", "group": 3, "x_axis": 120, "y_axis": 160},
        {"id": "evan", "group": 3, "x_axis": 160, "y_axis": 150}
      ]

      const links = [
        {"source": "aspyn", "target": "rob"},
        {"source": "aspyn", "target": "zx"},
        {"source": "aspyn", "target": "alex"},
        {"source": "zx", "target": "alex"},
        {"source": "zx", "target": "rob"},
        {"source": "rob", "target": "alex"},
        {"source": "zx", "target": "ken"},
        {"source": "zx", "target": "yung"},
        {"source": "ken", "target": "jake"},
        {"source": "ken", "target": "yung"},
        {"source": "jake", "target": "yung"},
        {"source": "boon", "target": "ani"},
        {"source": "rob", "target": "ani"},
        {"source": "alex", "target": "ken"},
        {"source": "boon", "target": "rob"}
      ]

      var nodesDict = {}
      nodes.forEach((node) => {
        nodesDict[node.id] = {
          "x_axis": node.x_axis,
          "y_axis": node.y_axis
        }
      })

      const linkFormatter = (link) => {
        link["x1"] = nodesDict[link.source].x_axis
        link["y1"] = nodesDict[link.source].y_axis
        link["x2"] = nodesDict[link.target].x_axis
        link["y2"] = nodesDict[link.target].y_axis
        return link
      }

      const formattedLinks = _.map(links, linkFormatter)

      var svgPaths = []
      formattedLinks.forEach((link) => {
        svgPaths.push([{
          "x": link.x1,
          "y": link.y1
        },
        {
          "x": link.x2,
          "y": link.y2
        }])
      })
      // console.log(nodesDict)
      // console.log(formattedLinks)
      console.log(svgPaths)

      const color = ["#3366cc", "#dc3912", "#ff9900", "#109618", "#990099"]

      const svgContainer = d3.select("body").append("svg")
        .attr("width", 500)
        .attr("height", 500);

      // const lines = svgContainer.selectAll("line")
      //   .attr("class", "line")
      //   .data(formattedLinks)
      //   .enter()
      //   .append("line")
      //   .style("stroke", "#999")
      //   .style("stroke-opacity", "0.6")
      //   .attr("x1", (d) => d.x1)
      //   .attr("y1", (d) => d.y1)
      //   .attr("x2", (d) => d.x2)
      //   .attr("y2", (d) => d.y2)

      const block = svgContainer.append("path")
        .attr("class", "block")
        .attr("d", "M0 0h24v24H0z")
        .attr("d", "M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 14H4V8l8 5 8-5v10zm-8-7L4 6h16l-8 5z")
        .attr("height", 20)
        .attr("width",  20);

      var line = d3.line()
        .x((d) => d.x)
        .y((d) => d.y)

      // var svgline = []
      var test = ""
      svgPaths.forEach((path) => {
        test += line(path)
      })
      

      var paths = svgContainer.append('path')
        .attr('d', test)
        .style("fill", "none")
        .style("stroke", "#999");

      // var paths = svgContainer.selectAll('path')
      //   .attr("class", "path")
      //   .data(svgPaths)
      //   .attr('d', (d) => line(d))
      //   .style("fill", "none")
      //   .style("stroke", "#999");

      const circles = svgContainer.selectAll("circle")
        .attr("class", "circle")
        .data(nodes)
        .enter()
        .append("circle")
        .attr("cx", (d) => d.x_axis)
        .attr("cy", (d) => d.y_axis)
        .attr("r", 5)
        .style("fill", (d) => color[d.group])

      const labels = svgContainer.selectAll("text")
        .data(nodes)
        .enter()
        .append("text")
        .attr("x", function(d) { return d.x_axis + 7; })
        .attr("y", function(d) { return d.y_axis + 2; })
        .text((d) => d.id)
        .attr("font-family", "sans-serif")
        .attr("font-size", "10px")
        .attr("fill", "black");

      const transition = function(block, paths) {
        var l = paths.node().getTotalLength()
        block.transition()
         .duration(5000)
         .attrTween("transform", delta(paths.node()));
      }
      
      const delta = function(paths) {
        var l = paths.getTotalLength();
        return function(i) {
          return function(t) {
            var p = paths.getPointAtLength(t * l);
            return "translate(" + p.x + "," + p.y + ")";
          }
        }
      }

      transition(block, paths)
    </script> -->
  </body>
</html>